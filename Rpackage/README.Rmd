---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# iProPath

<!-- badges: start -->

<!-- badges: end -->

## Installation

Method 1 — Install from Local Source File
``` {r, eval = FALSE}
install.packages("iProPath_1.0.0.tar.gz", repos = NULL, type = "source")
```

Method 2 — Install from GitHub
``` {r, eval = FALSE}
install.packages("devtools”)
devtools::install_github("songxiaoyu/iProPath/Rpackage")
```

## Example

### 1.1 Run via Terminal (Command Line)

The script can be executed from the terminal using:

```{bash, eval = FALSE}
Rscript run_analysis.R <file_name> <num_cores> <y_name> <x_name>
```

Arguments (fixed order):

`file_name` -- Name of the input data file (e.g., "sample_data")

`num_cores` -- Number of CPU cores to use (e.g., 6)

`y_name` -- Outcome variable name (e.g., "ptm")

`x_name` -- Predictor variable name (e.g., "genetic_feature")

example:

```{bash, eval = FALSE}
Rscript run_analysis.R sample_data 6 ptm genetic_feature
```

```{r, eval = FALSE}
args <- commandArgs(trailingOnly = TRUE)

file_name <- args[1]
num_cores <- as.numeric(args[2])
y_name <- args[3]
x_name <- args[4]
```

### 1.2. Run by Manually Editing Script Arguments

For interactive runs (e.g., in R Markdown or RStudio),  
arguments can be manually specified as a vector:

```{r, eval = FALSE}
# Manually define arguments (fixed order)
args <- list(
  "sample_data",        # file_name
  6,                    # num_cores
  "ptm",                # y_name
  "genetic_feature"    # x_name
)
file_name <- args[[1]]
num_cores <- as.numeric(args[[2]])
y_name <- args[[3]]
x_name <- args[[4]]
```

####  Load input data

```{r, eval = FALSE}
library(iProPath)
data("sample_data")
data=get(file_name)
```

### 2. Set basic parameters

```{r, eval = FALSE}
x_df_list=data$x_df_list
fixed_cov=data$fixed_cov
mediator_list=data$mediator_list
y_covdf_list=data$y_covdf_list
Y_list = data$Y_list
x_name = args[[4]]
y_name =  args[[3]]
num_cores = args[[2]]
file_name = args[[1]]
```

Loads:

x_df_list, fixed_cov, mediator_list, y_covdf_list, Y_list

### 3. Regression step

```{r example3, eval = FALSE}
reg_res <- prepare_ipropath_regression(
  x_df_list,
  fixed_cov,
  mediator_list,
  y_covdf_list,
  Y_list,
  x_name = x_name,
  y_name = y_name,
  num_cores = num_cores,
  adjust_methods = c("BH", "bonferroni", "BY")
)
```

### 4. Estimate non-null proportions

```{r example4, eval = FALSE}
pi_res <- estimate_ipropath_pi(
reg_res$merged_df$p_value_MX,
reg_res$merged_df$p_value_YM,
method = "qvalue.smoother",
run_all = FALSE
)
```

### 5. Run iProPath inference

```{r example5, eval = FALSE}
ipropath_res <- run_ipropath(
  reg_res$merged_df,
  pi_res$pi1_MX,
  pi_res$pi1_YM,
  num_cores = num_cores,
  y_name = y_name
)
```

### 6. Assemble final results

```{r example6, eval = FALSE}
res_all <- assemble_ipropath_results(
  pairwise_res = reg_res$pairwise_res,
  y_transreg = reg_res$y_transreg,
  ipropath_res_p = ipropath_res$res_p
)
```

### 7. Write outputs

```{r example7, eval = FALSE}
file_stub <- paste(file_name, x_name, y_name, sep = ".")
write_ipropath_outputs(
  res_all = res_all,
  real_data_pi_df = pi_res$pi_df,
  ipropath_pi_df = ipropath_res$pi_df,
  file_stub = file_stub,
  output_dir = "Results"
)
```
